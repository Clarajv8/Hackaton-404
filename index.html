<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error 404 - Warp Run</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Share+Tech+Mono&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #050505;
            font-family: 'Share Tech Mono', monospace;
            user-select: none;
            height: 100vh;
            width: 100vw;
            cursor: crosshair;
        }

        #space-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #game-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none; 
        }

        /* --- COHETE --- */
        .rocket-container {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 280px;
            height: 100px;
            z-index: 60; 
            pointer-events: auto;
            cursor: grab;
            transform: translate(-50%, -50%); 
            filter: drop-shadow(0 15px 25px rgba(0,0,0,0.9));
            transition: filter 0.3s;
        }

        .rocket-container:active { 
            cursor: grabbing; 
            filter: drop-shadow(0 0 15px #00aaff); /* Brillo al activar motores */
        }

        .rocket-inner-anim {
            width: 100%;
            height: 100%;
            position: relative;
            animation: rocketFloat 5s ease-in-out infinite;
        }

        /* Cuando activamos el turbo, el cohete vibra */
        .rocket-container.flying .rocket-inner-anim {
            animation: rocketVibrate 0.1s infinite !important;
        }

        .rocket-body {
            position: absolute;
            top: 10px;
            left: 0;
            width: 200px;
            height: 80px;
            background: linear-gradient(to bottom, #e6e6e6, #ffffff, #bfbfbf);
            border-radius: 10% 50% 50% 10% / 50% 50% 50% 50%;
            box-shadow: inset 0 -10px 20px rgba(0,0,0,0.3);
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #999;
        }

        .rivet {
            position: absolute;
            width: 4px; height: 4px;
            background: #888;
            border-radius: 50%;
            top: 10px; left: 50px;
            box-shadow: 20px 0 #888, 40px 0 #888, 60px 0 #888;
        }

        .rocket-nose {
            position: absolute;
            right: -35px;
            top: 10px;
            width: 0; 
            height: 0; 
            border-top: 40px solid transparent;
            border-bottom: 40px solid transparent;
            border-left: 60px solid #ff3333;
            z-index: 1;
        }

        .window {
            position: absolute;
            right: 40px;
            top: 20px;
            width: 35px;
            height: 35px;
            background: #00aaff;
            border: 4px solid #444;
            border-radius: 50%;
            box-shadow: inset 5px 5px 10px rgba(255,255,255,0.6);
            overflow: hidden;
        }
        .window::after {
            content: '';
            position: absolute;
            top: 5px; right: 5px;
            width: 10px; height: 10px;
            background: white;
            border-radius: 50%;
            opacity: 0.6;
        }

        .logo-404 {
            font-family: 'Black Ops One', cursive;
            font-size: 2.5rem;
            color: #222;
            opacity: 0.8;
            margin-right: 45px;
            transform: skewX(-10deg);
        }

        .fin {
            position: absolute;
            background: #ff3333;
            z-index: 1;
            border: 2px solid #cc0000;
        }
        .fin-top { 
            top: -20px; left: 20px; width: 60px; height: 40px; 
            transform: skewX(-30deg); border-radius: 10px 50px 0 0;
        }
        .fin-bottom { 
            bottom: -20px; left: 20px; width: 60px; height: 40px; 
            transform: skewX(30deg); border-radius: 0 0 50px 10px;
        }
        .fin-back {
            left: -10px; top: 30px; width: 20px; height: 40px;
            background: #990000; border-radius: 5px;
        }

        .exhaust-flame {
            position: absolute;
            left: -50px;
            top: 35px;
            width: 70px;
            height: 30px;
            background: linear-gradient(to left, transparent, #ffaa00, #ff3333);
            border-radius: 50% 0 0 50%;
            filter: blur(6px);
            animation: flameIdle 0.2s infinite alternate;
            z-index: 0;
            transition: all 0.3s;
        }

        /* Fuego Turbo */
        .rocket-container.flying .exhaust-flame {
            width: 180px; /* Llama muy larga */
            background: linear-gradient(to left, transparent, #00aaff, #ffffff); /* Fuego azul espacial */
            animation: flameTurbo 0.05s infinite alternate;
        }

        /* --- PLANETAS OBSTÁCULOS --- */
        .obstacle-planet {
            position: absolute;
            border-radius: 50%;
            z-index: 55; /* Entre piedras y cohete */
            box-shadow: inset -10px -10px 20px rgba(0,0,0,0.5);
        }

        /* --- PIEDRAS (Fondo/Interactivas) --- */
        .draggable {
            position: absolute;
            cursor: grab;
            z-index: 50;
            pointer-events: auto;
            touch-action: none;
        }
        .draggable:active { cursor: grabbing; }

        .rock-visual {
            width: 70px;
            height: 70px;
            background: radial-gradient(circle at 30% 30%, #8d6e63, #3e2723);
            border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.8), 5px 5px 10px rgba(0,0,0,0.3);
            animation: spinRock 20s linear infinite;
        }

        /* --- UI --- */
        .instructions {
            position: absolute;
            bottom: 30px;
            width: 100%;
            text-align: center;
            color: rgba(255,255,255,0.5);
            font-size: 0.9rem;
            pointer-events: none;
            z-index: 80;
        }
        .return-btn {
            pointer-events: auto;
            margin-top: 10px;
            padding: 8px 20px;
            background: rgba(255, 51, 51, 0.1);
            border: 1px solid #ff3333;
            color: #ff3333;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.3s;
            font-family: 'Share Tech Mono', monospace;
        }
        .return-btn:hover { background: #ff3333; color: white; box-shadow: 0 0 15px #ff3333; }

        /* --- ANIMACIONES --- */
        @keyframes rocketFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(1deg); }
        }
        @keyframes rocketVibrate {
            0% { transform: translate(1px, 1px); }
            25% { transform: translate(-1px, -1px); }
            50% { transform: translate(-1px, 1px); }
            75% { transform: translate(1px, -1px); }
            100% { transform: translate(0, 0); }
        }
        @keyframes flameIdle {
            0% { width: 60px; opacity: 0.8; }
            100% { width: 80px; opacity: 0.6; }
        }
        @keyframes flameTurbo {
            0% { width: 180px; opacity: 1; }
            100% { width: 200px; opacity: 0.9; }
        }
        @keyframes spinRock {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .shaking { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, -1px, 0); }
            20%, 80% { transform: translate3d(3px, 2px, 0); }
            30%, 50%, 70% { transform: translate3d(-5px, -3px, 0); }
            40%, 60% { transform: translate3d(5px, 3px, 0); }
        }

        /* Explosión de choque */
        .explosion {
            position: absolute;
            width: 10px; height: 10px;
            background: white;
            border-radius: 50%;
            z-index: 200;
            animation: explode 0.8s forwards ease-out;
        }
        @keyframes explode {
            0% { transform: scale(1); opacity: 1; background: #fff; }
            50% { transform: scale(30); opacity: 1; background: #ffaa00; }
            100% { transform: scale(100); opacity: 0; background: #ff0000; }
        }

        /* Efecto agujero negro (viejo) */
        .black-hole {
            position: absolute;
            width: 0; height: 0; background: black; border-radius: 50%;
            box-shadow: 0 0 40px 10px #fff, inset 0 0 60px #4b0082; z-index: 100;
            transform: translate(-50%, -50%);
            animation: expandBH 4s forwards ease-in-out;
        }
        @keyframes expandBH {
            0% { width: 0; height: 0; opacity: 1; }
            10% { width: 50px; height: 50px; }
            80% { width: 250vmax; height: 250vmax; }
            100% { width: 300vmax; height: 300vmax; background:black; box-shadow: none;}
        }

        .sucked-in {
            transition: all 0.8s cubic-bezier(0.55, 0.055, 0.675, 0.19);
            transform: scale(0) rotate(720deg) !important; opacity: 0;
        }
    </style>
</head>
<body>

    <canvas id="space-canvas"></canvas>

    <div id="game-layer">
        
        <!-- NAVE ESPACIAL -->
        <!-- Agregamos id 'spaceship' para lógica de juego -->
        <div class="rocket-container draggable-item" id="spaceship" style="left: 50%; top: 50%;" data-initial-left="50%" data-initial-top="50%">
            <div class="rocket-inner-anim">
                <div class="rocket-nose"></div>
                <div class="fin fin-top"></div>
                <div class="fin fin-bottom"></div>
                <div class="fin fin-back"></div>
                <div class="exhaust-flame"></div>
                <div class="rocket-body">
                    <div class="rivet"></div>
                    <div class="logo-404">ERROR 404</div>
                    <div class="window"></div>
                </div>
            </div>
        </div>

        <div class="instructions" id="instr">
            <p id="status-msg">MODO SEGURO: AGARRA LA NAVE PARA ACTIVAR HIPERVELOCIDAD</p>
            <button class="return-btn" onclick="location.href='/'">VOLVER A LA TIERRA</button>
            <p style="font-size: 0.7rem; margin-top: 8px; opacity: 0.5; color: #88ccff;">(Esquiva los planetas o junta piedras para colapsar)</p>
        </div>
    </div>

    <!-- Rocas estáticas/interactivas -->
    <div id="asteroid1" class="draggable-item rock-type" data-initial-left="15%" data-initial-top="20%" style="top: 20%; left: 15%;">
        <div class="rock-visual"></div>
    </div>
    <div id="asteroid2" class="draggable-item rock-type" data-initial-left="80%" data-initial-top="70%" style="top: 70%; left: 80%;">
        <div class="rock-visual" style="width: 50px; height: 50px; filter: brightness(0.8);"></div>
    </div>
    <div id="asteroid3" class="draggable-item rock-type" data-initial-left="85%" data-initial-top="40%" style="top: 40%; left: 85%;">
        <div class="rock-visual" style="width: 90px; height: 90px; filter: hue-rotate(30deg);"></div>
    </div>

    <script>
        /* --- SISTEMA CENTRAL --- */
        let isGameActive = false; // ¿Se está agarrando la nave?
        let isResetting = false; // ¿Estamos en animación de muerte?
        let obstacleSpeed = 0; // Velocidad actual de obstáculos
        const BASE_SPEED = 12; // Velocidad máxima de obstáculos

        /* --- FONDO ESTELAR --- */
        const canvas = document.getElementById('space-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let stars = [];

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();

        class Star {
            constructor() { this.init(); }
            init() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.baseSpeed = Math.random() * 0.5 + 0.1;
                this.size = Math.random() * 1.5;
            }
            update() {
                // Si el juego está activo, las estrellas van MUY rápido (hipervelocidad)
                let currentSpeed = isGameActive ? this.baseSpeed + 20 : this.baseSpeed;
                this.x -= currentSpeed;
                if (this.x < 0) {
                    this.x = width;
                    this.y = Math.random() * height;
                }
            }
            draw() {
                ctx.fillStyle = 'white';
                ctx.beginPath();
                // Estirar estrella si vamos rápido (efecto warp)
                if(isGameActive) {
                    ctx.rect(this.x, this.y, this.size + 20, this.size);
                } else {
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                }
                ctx.fill();
            }
        }
        for(let i=0; i<200; i++) stars.push(new Star());

        /* --- GESTOR DE OBSTÁCULOS (PLANETAS) --- */
        let obstacles = [];
        let obstacleTimer = 0;

        function spawnObstacle() {
            const size = 40 + Math.random() * 80;
            const el = document.createElement('div');
            el.classList.add('obstacle-planet');
            el.style.width = size + 'px';
            el.style.height = size + 'px';
            el.style.left = '110vw'; // Aparece fuera a la derecha
            // Posición vertical aleatoria pero dentro de márgenes
            el.style.top = (Math.random() * (window.innerHeight - size)) + 'px';
            
            // Colores aleatorios de planetas
            const hue = Math.random() * 360;
            el.style.background = `radial-gradient(circle at 30% 30%, hsl(${hue}, 80%, 60%), hsl(${hue}, 60%, 20%))`;
            
            document.getElementById('game-layer').appendChild(el);
            obstacles.push({ element: el, x: window.innerWidth + 100, speed: BASE_SPEED + Math.random() * 5 });
        }

        function updateObstacles() {
            if(isResetting) return;

            // Solo spawnear si estamos volando
            if(isGameActive) {
                obstacleTimer++;
                if(obstacleTimer > 40) { // Frecuencia de aparición
                    spawnObstacle();
                    obstacleTimer = 0;
                }
            }

            // Mover obstáculos existentes
            for (let i = obstacles.length - 1; i >= 0; i--) {
                let obs = obstacles[i];
                
                // Si el juego está inactivo, los planetas frenan
                if(!isGameActive) {
                   obs.x -= 1; // Velocidad residual lenta
                } else {
                   obs.x -= obs.speed; // Velocidad warp
                }
                
                obs.element.style.left = obs.x + 'px';

                // Eliminar si salen por la izquierda
                if (obs.x < -200) {
                    obs.element.remove();
                    obstacles.splice(i, 1);
                }
            }
            
            // Chequear colisiones
            checkShipCollision();
        }

        /* --- BUCLE PRINCIPAL --- */
        function animate() {
            // Fondo
            ctx.fillStyle = isGameActive ? '#000000' : '#050505';
            ctx.fillRect(0, 0, width, height);
            stars.forEach(s => { s.update(); s.draw(); });

            // Lógica de juego
            updateObstacles();

            requestAnimationFrame(animate);
        }
        animate();


        /* --- INPUT & DRAGGING --- */
        const draggables = document.querySelectorAll('.draggable-item');
        const spaceship = document.getElementById('spaceship');
        const statusMsg = document.getElementById('status-msg');

        draggables.forEach(elm => {
            let isDragging = false;
            let startX, startY, initialLeft, initialTop;

            // Listeners unificados
            const startHandler = (cx, cy) => start(cx, cy);
            const moveHandler = (cx, cy) => move(cx, cy);
            
            elm.addEventListener('mousedown', e => startHandler(e.clientX, e.clientY));
            window.addEventListener('mousemove', e => moveHandler(e.clientX, e.clientY));
            window.addEventListener('mouseup', stop);
            
            elm.addEventListener('touchstart', e => startHandler(e.touches[0].clientX, e.touches[0].clientY), {passive:false});
            window.addEventListener('touchmove', e => {
                if(isDragging) moveHandler(e.touches[0].clientX, e.touches[0].clientY);
            }, {passive:false});
            window.addEventListener('touchend', stop);

            function start(cx, cy) {
                if(isResetting) return;
                isDragging = true;
                startX = cx; startY = cy;
                initialLeft = elm.offsetLeft; initialTop = elm.offsetTop;
                
                elm.style.transition = 'none';
                
                // Si agarramos la nave
                if(elm.id === 'spaceship') {
                    isGameActive = true;
                    elm.classList.add('flying'); // Activa efecto turbo visual
                    statusMsg.innerText = "¡ALERTA DE COLISIÓN! ESQUIVA LOS OBSTÁCULOS";
                    statusMsg.style.color = "#ffaa00";
                    statusMsg.style.textShadow = "0 0 10px #ff0000";
                }
            }

            function move(cx, cy) {
                if(!isDragging) return;
                const dx = cx - startX;
                const dy = cy - startY;
                elm.style.left = (initialLeft + dx) + 'px';
                elm.style.top = (initialTop + dy) + 'px';

                // Chequear colisiones de piedras
                if (elm.classList.contains('rock-type')) checkRockCollision();
            }

            function stop() {
                isDragging = false;
                // Si soltamos la nave
                if(elm.id === 'spaceship') {
                    isGameActive = false;
                    elm.classList.remove('flying');
                    statusMsg.innerText = "MOTORES EN ESPERA - SISTEMA SEGURO";
                    statusMsg.style.color = "#fff";
                    statusMsg.style.textShadow = "none";
                }
            }
        });

        /* --- COLISIONES NAVE vs PLANETAS --- */
        function checkShipCollision() {
            if (!isGameActive || isResetting) return;

            const shipRect = spaceship.getBoundingClientRect();
            // Hacemos el hitbox de la nave un poco más pequeño para ser justos (zona central)
            const shipHitbox = {
                l: shipRect.left + 40, r: shipRect.right - 40,
                t: shipRect.top + 20, b: shipRect.bottom - 20
            };

            for (let obs of obstacles) {
                const obsRect = obs.element.getBoundingClientRect();
                // Hitbox planeta (círculo aproximado)
                const obsHitbox = {
                    l: obsRect.left + 10, r: obsRect.right - 10,
                    t: obsRect.top + 10, b: obsRect.bottom - 10
                };

                // AABB Collision
                if (shipHitbox.l < obsHitbox.r && shipHitbox.r > obsHitbox.l &&
                    shipHitbox.t < obsHitbox.b && shipHitbox.b > obsHitbox.t) {
                    triggerCrash(spaceship.offsetLeft, spaceship.offsetTop);
                }
            }
        }

        /* --- COLISIONES PIEDRA vs PIEDRA (Vieja mecánica) --- */
        function checkRockCollision() {
            if(isResetting) return;
            const rocks = document.querySelectorAll('.rock-type');
            for(let i=0; i<rocks.length; i++) {
                for(let j=i+1; j<rocks.length; j++) {
                    const r1 = rocks[i].getBoundingClientRect();
                    const r2 = rocks[j].getBoundingClientRect();
                    const dist = Math.hypot((r1.left+r1.width/2) - (r2.left+r2.width/2), (r1.top+r1.height/2) - (r2.top+r2.height/2));
                    if(dist < 60) triggerSingularity((r1.left+r1.width/2), (r1.top+r1.height/2));
                }
            }
        }

        /* --- EVENTO DE MUERTE (CHOQUE) --- */
        function triggerCrash(x, y) {
            isResetting = true;
            isGameActive = false;

            // 1. Explosión visual
            const boom = document.createElement('div');
            boom.className = 'explosion';
            boom.style.left = x + 'px';
            boom.style.top = y + 'px';
            document.body.appendChild(boom);

            // 2. Temblor
            document.body.classList.add('shaking');
            statusMsg.innerText = "¡IMPACTO CRÍTICO!";

            // 3. Ocultar nave
            spaceship.style.opacity = 0;

            // 4. Reinicio
            setTimeout(() => {
                fullReset(boom);
            }, 2000);
        }

        /* --- EVENTO DE SINGULARIDAD (PIEDRAS) --- */
        function triggerSingularity(x, y) {
            isResetting = true;
            isGameActive = false;
            const bh = document.createElement('div');
            bh.className = 'black-hole';
            bh.style.left = x + 'px';
            bh.style.top = y + 'px';
            document.body.appendChild(bh);
            document.body.classList.add('shaking');
            
            document.querySelectorAll('.draggable-item').forEach(obj => {
                obj.style.transition = "all 0.8s ease-in";
                obj.style.left = x + 'px';
                obj.style.top = y + 'px';
                obj.classList.add('sucked-in');
            });

            setTimeout(() => {
                document.getElementById('space-canvas').style.opacity = 0;
                setTimeout(() => fullReset(bh), 2000);
            }, 2000);
        }

        /* --- REINICIO TOTAL --- */
        function fullReset(effectElement) {
            if(effectElement) effectElement.remove();
            
            // Limpiar obstáculos
            obstacles.forEach(o => o.element.remove());
            obstacles = [];

            // Restaurar objetos
            const allObjects = document.querySelectorAll('.draggable-item');
            allObjects.forEach(obj => {
                obj.style.transition = 'none';
                obj.classList.remove('sucked-in');
                obj.style.opacity = 1;
                obj.style.left = obj.dataset.initialLeft;
                obj.style.top = obj.dataset.initialTop;
                obj.classList.remove('flying');
            });

            document.body.classList.remove('shaking');
            document.getElementById('space-canvas').style.opacity = 1;
            statusMsg.innerText = "SISTEMA REINICIADO. LISTO PARA DESPEGUE.";
            statusMsg.style.color = "#fff";
            statusMsg.style.textShadow = "none";

            isResetting = false;
        }

    </script>
</body>
</html>